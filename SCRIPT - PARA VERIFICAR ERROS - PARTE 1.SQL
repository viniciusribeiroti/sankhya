									#######################################
									###   SCRIPT PARA VERIFICAR ERROS   ###
									#######################################

#################
###   TSCID   ###
#################


 -- POR CÓDIGO IBGE - Cidades repetidas
SELECT TSICID.DESCRICAOCORREIO, COUNT(*)
FROM TSICID
GROUP BY TSICID.DESCRICAOCORREIO, CODMUNFIS
HAVING COUNT(*) > 1


-- Por nome de Cidade - Cidade Repetidas

SELECT TSICID.DESCRICAOCORREIO, COUNT(*)
FROM TSICID
GROUP BY TSICID.DESCRICAOCORREIO
HAVING COUNT(*) > 1



#################
###   TGFTEL  ###
#################

-- Verificar quando o código do usuário está diferente do atendente.  VICE E VERSA
SELECT COUNT(*)
FROM TGFTEL 
WHERE TGFTEL.CODUSU <> TGFTEL.CODATENDENTE


-- Clientes que não tem o segmento definido

SELECT TGFPAR.CODPARC, TGFPAR.NOMEPARC
FROM TGFPAR
WHERE TGFPAR.CLIENTE = 'S' 
AND TGFPAR.CODPARC NOT IN (SELECT TGFPPA.CODPARC 
							   FROM TGFPPA 
							   WHERE CODTIPPARC > 10100000 
								 AND CODTIPPARC < 10200000)


##############################
###  Registros Duplicados  ###
##############################



-- Clientes Duplicados

SELECT TGFPAR.NOMEPARC, TGFPAR.CGC_CPF, COUNT(*)
FROM TGFPAR
WHERE TGFPAR.CLIENTE = 'S'
AND   TGFPAR.FORNECEDOR = 'N'
GROUP BY TGFPAR.NOMEPARC, TGFPAR.CGC_CPF
HAVING COUNT(*) > 1

-- Fornecedores Duplicados

SELECT TGFPAR.NOMEPARC, TGFPAR.CGC_CPF, COUNT(*)
FROM TGFPAR
WHERE TGFPAR.CLIENTE = 'N'
AND   TGFPAR.FORNECEDOR = 'S'
GROUP BY TGFPAR.NOMEPARC, TGFPAR.CGC_CPF
HAVING COUNT(*) > 1

-- Tipos de Negociação.

SELECT DESCRTIPVENDA, COUNT(*)
FROM TGFTPV
GROUP BY TGFTPV.DESCRTIPVENDA
HAVING COUNT(*) > 1

-- Perfis com nomes duplicados

SELECT TGFTPP.DESCRTIPPARC, COUNT (*)
FROM TGFTPP
GROUP BY TGFTPP.DESCRTIPPARC
HAVING COUNT(*) > 1

-- Usuários duplicados

SELECT TSIUSU.NOMEUSU, COUNT(*)
FROM TSIUSU
GROUP BY TSIUSU.NOMEUSU
HAVING COUNT (*) > 1

-- Vendedores Duplicados

SELECT TGFVEN.APELIDO, COUNT(*)
FROM TGFVEN
GROUP BY TGFVEN.APELIDO
HAVING COUNT(*) > 1


-- Cliente com atendimentos duplicados

SELECT CODPARC,
	   (SELECT TGFPAR.NOMEPARC FROM TGFPAR WHERE TGFPAR.CODPARC = TGFTEL.CODPARC) AS NOMEPARC,
	   COUNT(*)
FROM TGFTEL 
GROUP BY CODPARC
HAVING COUNT(*) > 1

##############################
### CLIENTES  ###
##############################


-- Clientes sem vendas

-- CONTADOR
SELECT COUNT (*)
FROM TGFPAR
WHERE TGFPAR.CODPARC NOT IN (SELECT TGFCAB.CODPARC  FROM TGFCAB )

--RELATORIO
SELECT TGFPAR.CODPARC, 
	   TGFPAR.NOMEPARC, 
	   ISNULL((SELECT TOP(1) TGFCTT.NOMECONTATO FROM TGFCTT WHERE TGFCTT.CODPARC = TGFPAR.CODPARC), '*** SEM CONTATO **') AS CONTATOS,
	   TGFPAR.TELEFONE
FROM TGFPAR
LEFT  JOIN TGFCTT AS CTT ON CTT.CODPARC = TGFPAR.CODPARC
WHERE TGFPAR.CLIENTE = 'S'
AND   TGFPAR.FORNECEDOR = 'N'
AND TGFPAR.CODPARC NOT IN (SELECT TGFCAB.CODPARC  FROM TGFCAB )
GROUP BY TGFPAR.CODPARC, 
		 TGFPAR.NOMEPARC, 
	     TGFPAR.TELEFONE




##############################
### CLIENTES SEM PERFIL TRIBUTÁRIO  ###
##############################

SELECT COUNT(*)
FROM TGFPAR
WHERE TGFPAR.CODTIPPARC IS NULL
OR TGFPAR.CODTIPPARC = 0


SELECT TGFPAR.CODPARC, TGFPAR.NOMEPARC, TGFPAR.CODTIPPARC
FROM TGFPAR
WHERE TGFPAR.CODTIPPARC IS NULL
OR TGFPAR.CODTIPPARC = 0
ORDER BY NOMEPARC




########################################################
### Quantidade de lanc contabil no mês de referência ###
########################################################

SELECT CODEMP, NUMLOTE, REFERENCIA, COUNT (*) AS QUANTLANC
FROM TCBLAN
WHERE TCBLAN.NUMLOTE IN (50)
AND   TCBLAN.CODEMP = 2
AND   TCBLAN.REFERENCIA BETWEEN '2019-01-01' AND '2019-12-31'
GROUP BY CODEMP, NUMLOTE, REFERENCIA



#########################################################
### Data de Negociação maior que data de movimentação ###
#########################################################

SELECT TGFFIN.DTNEG, TGFFIN.DTENTSAI, TGFFIN.DHMOV, *
FROM TGFFIN 
WHERE TGFFIN.DTNEG > DHMOV 


########################
# CORREÇÃO NOME CIDADE #
########################

-- STO PARA SANTO
SELECT REPLACE(NOMECID, 'STO', 'SANTO')
FROM TSICID 
WHERE TSICID.NOMECID LIKE 'STO%'


 -- STA PARA SANTA
SELECT REPLACE(NOMECID, 'STA', 'SANTA')
FROM TSICID 
WHERE TSICID.NOMECID LIKE 'STA%'


-- CAP. PARA CAPITAO
SELECT REPLACE(NOMECID, 'CAP.', 'CAPITAO')
FROM TSICID 
WHERE TSICID.NOMECID LIKE 'CAP.%'

-- DEP PARA DEUPATDO 
SELECT REPLACE(NOMECID, 'DEP', 'DEPUTADO ')
FROM TSICID 
WHERE TSICID.NOMECID LIKE 'DEP %'

-- COM. COMENDADOR
SELECT REPLACE(NOMECID, 'COM.', 'COMENDADOR')
FROM TSICID 
WHERE TSICID.NOMECID LIKE 'COM. %'

